<analysis>**original_problem_statement:**
The user requires a comprehensive business management application for a 50-person consulting organization covering HR, Marketing, Sales, Finance, and Consulting projects.

**PRODUCT REQUIREMENTS (based on user clarifications):**
-   **Authentication & Roles:** A comprehensive, customizable role and permissions management system, including Google Auth.
-   **Top-Down Sales Workflow:** A sales process where the salesperson inputs the , and the system auto-allocates costs and calculates the rate-per-meeting for each team member based on admin-defined rules. The flow is Pricing Plan → SOW → Quotation → Agreement → Approval.
-   **Project Kickoff Workflow:** A formal handover process from Sales to Consulting. The consulting team must not have visibility into any project pricing, costing, or financial data.
-   **Dynamic & Role-Specific Dashboards:** Users should see dashboards tailored to their department.
-   **Modules:** Employees, Client Master, Expenses, Reporting, Meetings & MOM, HR (Leave, Attendance, Payroll), My Workspace, Project Management, and a new **Admin Masters** module for managing core business rules (e.g., cost allocation percentages).
-   **P&L / Variance Tracking:** The ability to flag projects where actual delivery (e.g., number of meetings held) exceeds the committed scope, impacting profitability.

**User's preferred language**: English

**what currently exists?**
A full-stack application with a sales funnel (Pricing Plan -> Quotation -> Agreement). The application now uses a top-down pricing model where the salesperson inputs a , and the system reverse-calculates team member rates based on allocation rules. An Admin Masters module exists for managing these rules. The  page also features a Payment Plan Breakup section, which auto-generates a monthly payment schedule based on the project start date and includes selectable components like GST and TDS.

**Last working item**:
-   **Last item agent was working:** The user requested a modification to the Payment Plan Breakup feature. Instead of being a percentage, Conveyance should be a single, lumpsum amount input by the user, which is then distributed evenly across the monthly payment schedule. The agent has acknowledged this requirement and is ready to begin implementation.
-   **Status:** NOT STARTED
-   **Agent Testing Done:** N
-   **Which testing method agent to use?** both
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   **Issue 1: Implement Lumpsum Conveyance in Payment Plan (P0)**
-   **Issue 2: Complete Workflow & Dashboard Redesign (P2)**
-   **Issue 3: Monolithic  file (P3 - Tech Debt)**

**Issues Detail:**
-   **Issue 1: Implement Lumpsum Conveyance in Payment Plan**
    -   **Attempted fixes:** None. This is a new requirement based on the last user message.
    -   **Next debug checklist:**
        1.  **Frontend ():** Modify the Conveyance component in the Payment Components section from a percentage-based checkbox to a currency input field for a lumpsum amount.
        2.  **Frontend ():** Update the calculation logic to divide the entered lumpsum conveyance amount by the number of payment periods (e.g., 12 months).
        3.  **Frontend ():** Ensure the Payment Schedule Table correctly displays this distributed conveyance amount in a new Conveyance column and updates the Net Receivable for each month.
        4.  **Backend ():** Update the  model within the  model to store  instead of a percentage.
        5.  **Testing:** Perform an end-to-end test: enter a total investment, add a team, input a lumpsum conveyance amount, and verify the payment schedule table is calculated correctly.
    -   **Why fix this issue and what will be achieved with the fix?** To align the application with the user's business requirement for handling conveyance costs as a fixed total amount rather than a variable percentage.
    -   **Status:** NOT STARTED
    -   **Is recurring issue?** N
    -   **Should Test frontend/backend/both after fix?** both
    -   **Blocked on other issue:** None

-   **Issue 2: Complete Workflow & Dashboard Redesign**
    -   **Next debug checklist:**
        1.  Design and implement the Consulting Efficiency Scorecard dashboard.
        2.  Create dashboards for other departments (HR, Finance).
    -   **Why fix this issue and what will be achieved with the fix?** To fulfill the core request for a fully dynamic, role-specific application experience.
    -   **Status:** NOT STARTED
    -   **Is recurring issue?** N
    -   **Should Test frontend/backend/both after fix?** both
    -   **Blocked on other issue:** None

-   **Issue 3: Monolithic  file**
    -   **Next debug checklist:**
        1.  Create a  directory in  (already done).
        2.  Move remaining related models and endpoints from  into separate router files (e.g., , ).
        3.  Update  to use  for the new router files.
    -   **Why fix this issue and what will be achieved with the fix?** To improve code maintainability and scalability.
    -   **Status:** NOT STARTED
    -   **Is recurring issue?** Y
    -   **Should Test frontend/backend/both after fix?** backend
    -   **Blocked on other issue:** None

**In progress Task List**:
-   None.

**Upcoming and Future Tasks**
-   **Upcoming Tasks (P1):**
    -   **P&L Variance Tracking:** Implement logic to flag over-delivery (actual vs. committed meetings) during project execution.
    -   **Employee Cost Integration:** Integrate with HR/Payroll data to pull actual employee CTC for P&L calculations.
    -   **Project P&L Dashboard:** Create a dashboard showing committed vs. actual costs and revenue with variance alerts.
    -   **Masters Sync Engine:** Ensure all forms across the application are automatically updated when an admin changes data in the Masters module.
-   **Future Tasks (P2):**
    -   **Finance Module:** Build out a full finance module for P&L, invoicing, and revenue recognition.
    -   **Detailed Reporting:** Create reports for role-wise and client-wise profitability.
    -   **Real Email Integration (SMTP).**
    -   **Rocket Reach Integration.**

**Completed work in this session**
-   **Top-Down Pricing Redesign (P0 Task):**
    -   Created a backend Admin Masters module () and a corresponding frontend UI () to manage allocation rules for team members.
    -   Rewrote the  page to use a top-down model, where the  is the primary input, and all team member rates are auto-calculated and read-only.
    -   Updated backend models in  to support this new data structure.
    -   Fully tested the flow using the testing agent.
-   **Payment Plan Breakup Feature:**
    -   Added a Payment Plan Breakup section to .
    -   Implemented a dynamic monthly payment schedule table based on a project start date.
    -   Included multi-select components for GST, TDS, and Conveyance (initially as a percentage).
    -   The feature was fully tested using the testing agent.

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: Monolithic  file.**
    -   **Debug checklist:** Plan and execute the refactoring of  into separate FastAPI routers.
    -   **Why to solve this issue and what will be achieved with this?** To improve code maintainability and scalability.
    -   **Should Test frontend/backend/both after fix:** backend
    -   **Is recurring issue?** Y

**Known issue recurrence from previous fork**
-   The monolithic  file remains a recurring technical debt issue.

**Code Architecture**


**Key Technical Concepts**
-   **Frontend:** React, Tailwind CSS, Shadcn/UI, Controlled Components, , .
-   **Backend:** FastAPI, Pydantic, Motor (async MongoDB).
-   **Architecture:** Single source of truth data flow, Top-down pricing model.

**key DB schema**
-   **PricingPlan ():** The model now includes  and a nested  object which stores the start date, schedule type, and component selections. The  sub-model stores the calculated breakup amount and rate per meeting.

**All files of reference**
-   : **This file needs modification** for the new lumpsum conveyance logic.
-   : **This file needs modification** to store the lumpsum conveyance amount.
-   : The  endpoint might need verification after the model change.
-   : The newly created Admin Masters page (completed).
-   : The newly created Masters router (completed).

**Areas that need refactoring**:
-    needs to be broken down into smaller router files.
-   The payment plan logic in  will be refactored to support the lumpsum conveyance requirement.

**key api endpoints**
-   : Handles creation of pricing plans with the new top-down and payment plan structure.
-   : Full CRUD for tenure types.
-   : Full CRUD for allocation rules.

**Critical Info for New Agent**
-   Your immediate priority (P0) is to implement the user's latest request: change the Conveyance field in the Payment Plan section from a percentage to a **lumpsum amount**. This amount should be distributed evenly across the months in the payment schedule table.
-   The core Top-Down Pricing and Admin Masters features are complete and have been tested. Do not alter this core logic.
-   The refactoring of the monolithic  file remains a P3 technical debt task to be addressed after higher-priority features.

**documents and test reports created in this job**
-   
-   
-   

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Requests to remove the Growth Guarantee section and add a Payment Plan Breakup section with multi-select components (like GST, TDS, Conveyance).
2.  **Agent:** Implements the Payment Plan Breakup feature as requested.
3.  **Agent:** Verifies the implementation with a screenshot showing the new section works correctly with percentage-based components.
4.  **Agent:** Runs the testing agent, which confirms both backend and frontend pass with a 100% success rate.
5.  **User (Pending):** only one change as conveyance is not fixed % , pls have top down pricing input that can be splitted across all tenures , lumsum inputs required - This is the current, highest-priority task.

**Project Health Check:**
-   **Broken:** None.
-   **Mocked:** Email sending functionality.
-   **Needs Rework:** The Conveyance calculation logic in  must be changed from a percentage to a lumpsum distribution model. The  monolith remains a critical tech debt item.

**3rd Party Integrations**
-   **Emergent-managed Google Auth**
-   **DHTMLX Gantt** (Mentioned in original spec, not yet implemented)
-   **Rocket Reach** (Requested, not implemented)

**Testing status**
-   **Testing agent used after significant changes:** YES. The agent ran the testing agent twice after completing the Top-Down Pricing feature and the Payment Plan feature.
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:**
    -   
    -   
-   **Known regressions:** None.

**Credentials to test flow:**
-   **Admin:**  / 
-   **Manager:**  / 
-   **Executive:**  / 

**What agent forgot to execute**
-   The agent has been diligent and has not forgotten to execute any planned tasks or user requests from the session. The agent correctly prioritized the user's latest feedback as the next item to work on.</analysis>
