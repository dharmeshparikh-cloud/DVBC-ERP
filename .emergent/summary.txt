<analysis>**original_problem_statement:**
The user is developing a comprehensive business management ERP named NETRA. The initial goal was to restore the application after a failed feature rollback. Following the restoration, the user requested several major new features and enhancements:
1.  **Internal Chat System:** A real-time chat for all users, including direct messages and group channels.
2.  **AI Assistant:** An integrated OpenAI-powered assistant for ERP data analysis and reporting with Role-Based Access Control (RBAC).
3.  **Email Action System:** A system for sending notifications with one-click approval/rejection links that work without logging into the app. All approval workflows must trigger these emails automatically.
4.  **Admin Controls:** Admins should be able to audit all chat conversations and restrict users.
5.  **Approval Center Enhancements:** The central approval dashboard should have real-time updates via WebSockets, bulk action capabilities, and a mobile-friendly design.
6.  **Day 0 Onboarding Tour:** A guided walkthrough for first-time users, highlighting key features, with role-specific content and a replay option.
7.  **AI-Powered Guidance System:** A contextual help system available on all pages to provide step-by-step guides for complex tasks and offer on-demand AI assistance that can navigate the user to the correct page.

**User's preferred language**: English

**what currently exists?**
The application is a stable and feature-rich full-stack ERP (React, FastAPI, MongoDB). All initial restoration work and previously requested core features (Chat, AI Assistant, RBAC, real-time notifications, email actions) are complete and tested.

Key completed enhancements include:
-   **Centralized Approval Notifications:** All workflows (leave, expenses, SOW, etc.) now use a centralized service to automatically trigger real-time email and WebSocket notifications.
-   **Enhanced Approval Center:** The  page now features real-time updates, bulk approval actions, and a responsive mobile layout.
-   **Guided Onboarding Tour:** A custom, non-library-based onboarding tour guides new users through the UI. It's role-specific, triggers automatically on first login, and can be replayed from the user's profile.

The agent has begun implementing the next major feature: a hybrid AI-powered guidance system.

**Last working item**:
-   **Last item agent was working:** Implementing the Hybrid Guidance System. The agent created the necessary frontend components (, , ), the backend router (), and the JSON file for static checklists (). The agent's last action was fixing a  in  where the  environment variable was not being loaded correctly.
-   **Status:** IN PROGRESS
-   **Agent Testing Done:** N
-   **Which testing method agent to use?** Both.
    -   **Frontend:** Use the  tool to verify the floating Help Me button is visible. Then, use the  to test the full user flow: clicking the button, opening the modal, asking for help, receiving an AI response, and verifying the auto-navigation to the correct page.
    -   **Backend:** Use  to test the  endpoint directly to ensure it connects to the LLM and returns valid responses.
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   **Issue 1: Verify Backend Fix for Guidance System (P0)**
    -   **Attempted fixes:** The agent added  and  to  to resolve a .
    -   **Next debug checklist:**
        1.  Restart the backend service to ensure the change is live.
        2.  Take a screenshot of the frontend to confirm the app loads without crashing and the floating help button appears.
        3.  If it fails, check the backend logs (==> /var/log/supervisor/backend.err.log <==
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     ('10.64.132.213', 43122) - "WebSocket /api/chat/ws/48588b92-8856-4e3a-aa6c-b9e493442761" [accepted]
2026-02-21 06:41:14,328 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 connected. Total connections: 1
INFO:     connection open
INFO:     ('10.64.130.211', 51246) - "WebSocket /api/chat/ws/48588b92-8856-4e3a-aa6c-b9e493442761" [accepted]
2026-02-21 06:41:14,796 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 connected. Total connections: 2
INFO:     connection open
INFO:     ('10.64.132.213', 52798) - "WebSocket /api/chat/ws/48588b92-8856-4e3a-aa6c-b9e493442761" [accepted]
2026-02-21 06:41:27,088 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 connected. Total connections: 3
INFO:     connection open
INFO:     ('10.64.130.211', 36498) - "WebSocket /api/chat/ws/48588b92-8856-4e3a-aa6c-b9e493442761" [accepted]
2026-02-21 06:41:27,785 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 connected. Total connections: 4
INFO:     connection open
2026-02-21 06:41:28,089 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 disconnected
2026-02-21 06:41:28,089 - routers.chat - INFO - WebSocket disconnected for user 48588b92-8856-4e3a-aa6c-b9e493442761
INFO:     connection closed
INFO:     ('10.64.132.213', 52802) - "WebSocket /api/chat/ws/48588b92-8856-4e3a-aa6c-b9e493442761" [accepted]
2026-02-21 06:41:28,838 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 connected. Total connections: 4
INFO:     connection open
2026-02-21 06:41:29,178 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 disconnected
2026-02-21 06:41:29,178 - routers.chat - INFO - WebSocket disconnected for user 48588b92-8856-4e3a-aa6c-b9e493442761
INFO:     connection closed
INFO:     ('10.64.130.211', 36516) - "WebSocket /api/chat/ws/48588b92-8856-4e3a-aa6c-b9e493442761" [accepted]
2026-02-21 06:41:29,323 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 connected. Total connections: 4
INFO:     connection open
2026-02-21 06:41:29,692 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 disconnected
2026-02-21 06:41:29,692 - routers.chat - INFO - WebSocket disconnected for user 48588b92-8856-4e3a-aa6c-b9e493442761
INFO:     connection closed
INFO:     ('10.64.132.213', 40446) - "WebSocket /api/chat/ws/48588b92-8856-4e3a-aa6c-b9e493442761" [accepted]
2026-02-21 06:41:29,787 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 connected. Total connections: 4
INFO:     connection open
2026-02-21 06:41:30,083 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 disconnected
2026-02-21 06:41:30,084 - routers.chat - INFO - WebSocket disconnected for user 48588b92-8856-4e3a-aa6c-b9e493442761
INFO:     connection closed
2026-02-21 06:41:36,547 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 disconnected
2026-02-21 06:41:36,548 - routers.chat - INFO - WebSocket disconnected for user 48588b92-8856-4e3a-aa6c-b9e493442761
INFO:     connection closed
2026-02-21 06:41:37,032 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 disconnected
2026-02-21 06:41:37,033 - routers.chat - INFO - WebSocket disconnected for user 48588b92-8856-4e3a-aa6c-b9e493442761
2026-02-21 06:41:37,034 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 disconnected
2026-02-21 06:41:37,034 - routers.chat - INFO - WebSocket disconnected for user 48588b92-8856-4e3a-aa6c-b9e493442761
INFO:     connection closed
INFO:     connection closed
WARNING:  WatchFiles detected changes in 'server.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [10085]
INFO:     Started server process [10681]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
2026-02-21 06:46:44,595 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/root/.venv/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
INFO:     ('10.64.132.213', 60420) - "WebSocket /api/chat/ws/48588b92-8856-4e3a-aa6c-b9e493442761" [accepted]
2026-02-21 06:46:51,649 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 connected. Total connections: 1
INFO:     connection open
INFO:     ('10.64.130.211', 55834) - "WebSocket /api/chat/ws/48588b92-8856-4e3a-aa6c-b9e493442761" [accepted]
2026-02-21 06:46:51,880 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 connected. Total connections: 2
INFO:     connection open
2026-02-21 06:46:53,297 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 disconnected
2026-02-21 06:46:53,303 - routers.chat - INFO - WebSocket disconnected for user 48588b92-8856-4e3a-aa6c-b9e493442761
INFO:     connection closed
2026-02-21 06:46:53,314 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 disconnected
2026-02-21 06:46:53,314 - routers.chat - INFO - WebSocket disconnected for user 48588b92-8856-4e3a-aa6c-b9e493442761
INFO:     connection closed
INFO:     ('10.64.130.211', 50200) - "WebSocket /api/chat/ws/48588b92-8856-4e3a-aa6c-b9e493442761" [accepted]
2026-02-21 06:46:53,581 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 connected. Total connections: 1
INFO:     connection open
INFO:     ('10.64.130.211', 50212) - "WebSocket /api/chat/ws/48588b92-8856-4e3a-aa6c-b9e493442761" [accepted]
2026-02-21 06:46:53,788 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 connected. Total connections: 2
INFO:     connection open
2026-02-21 06:46:54,542 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 disconnected
2026-02-21 06:46:54,542 - routers.chat - INFO - WebSocket disconnected for user 48588b92-8856-4e3a-aa6c-b9e493442761
INFO:     connection closed
2026-02-21 06:46:55,106 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 disconnected
2026-02-21 06:46:55,107 - routers.chat - INFO - WebSocket disconnected for user 48588b92-8856-4e3a-aa6c-b9e493442761
INFO:     connection closed
INFO:     ('10.64.132.213', 60444) - "WebSocket /api/chat/ws/48588b92-8856-4e3a-aa6c-b9e493442761" [accepted]
2026-02-21 06:46:55,753 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 connected. Total connections: 1
INFO:     connection open
INFO:     ('10.64.132.213', 51090) - "WebSocket /api/chat/ws/48588b92-8856-4e3a-aa6c-b9e493442761" [accepted]
2026-02-21 06:46:59,278 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 connected. Total connections: 2
INFO:     connection open
2026-02-21 06:47:01,778 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 disconnected
2026-02-21 06:47:01,778 - routers.chat - INFO - WebSocket disconnected for user 48588b92-8856-4e3a-aa6c-b9e493442761
INFO:     connection closed
2026-02-21 06:47:02,576 - websocket_manager - INFO - User 48588b92-8856-4e3a-aa6c-b9e493442761 disconnected
2026-02-21 06:47:02,579 - routers.chat - INFO - WebSocket disconnected for user 48588b92-8856-4e3a-aa6c-b9e493442761
INFO:     connection closed
INFO:     Will watch for changes in these directories: ['/app/backend']
INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
INFO:     Started reloader process [46] using WatchFiles
INFO:     Started server process [86]
INFO:     Waiting for application startup.
INFO:     Application startup complete.

==> /var/log/supervisor/backend.out.log <==
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:33092 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:36050 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:47160 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:42120 - "GET /api/hr/pending-attendance-approvals HTTP/1.1" 200 OK
INFO:     10.64.132.213:60652 - "GET /api/hr/bank-change-requests HTTP/1.1" 200 OK
INFO:     10.64.130.211:42102 - "GET /api/leave-requests?status=pending HTTP/1.1" 200 OK
INFO:     10.64.130.211:42110 - "GET /api/ctc/pending-approvals HTTP/1.1" 200 OK
INFO:     10.64.132.213:60640 - "GET /api/expenses?status=pending HTTP/1.1" 200 OK
INFO:     10.64.132.213:60640 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:60640 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:42120 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:42120 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:60640 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:52800 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:36502 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:36502 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:52800 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:52800 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:36502 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:36502 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:36502 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:40476 - "GET /api/hr/bank-change-requests HTTP/1.1" 200 OK
INFO:     10.64.132.213:40494 - "GET /api/ctc/pending-approvals HTTP/1.1" 200 OK
INFO:     10.64.132.213:40456 - "GET /api/hr/pending-attendance-approvals HTTP/1.1" 200 OK
INFO:     10.64.132.213:40464 - "GET /api/expenses?status=pending HTTP/1.1" 200 OK
INFO:     10.64.132.213:40486 - "GET /api/leave-requests?status=pending HTTP/1.1" 200 OK
INFO:     10.64.132.213:58078 - "POST /api/auth/login HTTP/1.1" 200 OK
INFO:     10.64.130.211:55824 - "GET /api/role-management/my-permissions HTTP/1.1" 200 OK
INFO:     10.64.132.213:58078 - "GET /api/my/check-status HTTP/1.1" 400 Bad Request
INFO:     10.64.130.211:55824 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:55824 - "GET /api/stats/consulting HTTP/1.1" 404 Not Found
INFO:     10.64.130.211:55854 - "GET /api/stats/hr HTTP/1.1" 404 Not Found
INFO:     10.64.130.211:55848 - "GET /api/department-access/my-access HTTP/1.1" 200 OK
INFO:     10.64.132.213:58078 - "GET /api/stats/hr HTTP/1.1" 404 Not Found
INFO:     10.64.130.211:55824 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:50186 - "GET /api/stats/consulting HTTP/1.1" 404 Not Found
INFO:     10.64.130.211:55854 - "GET /api/my/check-status HTTP/1.1" 400 Bad Request
INFO:     10.64.132.213:60436 - "GET /api/department-access/my-access HTTP/1.1" 200 OK
INFO:     10.64.130.211:55824 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:50186 - "GET /api/my/onboarding-status HTTP/1.1" 200 OK
INFO:     10.64.130.211:50186 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:55838 - "GET /api/stats/sales-dashboard-enhanced?view_mode=team HTTP/1.1" 200 OK
INFO:     10.64.130.211:50186 - "GET /api/stats/sales-dashboard-enhanced?view_mode=team HTTP/1.1" 200 OK
INFO:     10.64.130.211:50186 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.132.213:51100 - "GET /api/notifications/unread-count HTTP/1.1" 200 OK
INFO:     10.64.130.211:50186 - "GET /api/hr/bank-change-requests HTTP/1.1" 200 OK
INFO:     10.64.130.211:50216 - "GET /api/ctc/pending-approvals HTTP/1.1" 200 OK
INFO:     10.64.132.213:51100 - "GET /api/expenses?status=pending HTTP/1.1" 200 OK
INFO:     10.64.132.213:51110 - "GET /api/hr/pending-attendance-approvals HTTP/1.1" 200 OK
INFO:     10.64.132.213:51120 - "GET /api/leave-requests?status=pending HTTP/1.1" 200 OK) for any remaining errors related to environment variables.
    -   **Why fix this issue and what will be achieved with the fix?** This is a critical blocker. Fixing it will make the AI-powered help feature functional.
    -   **Status:** IN PROGRESS
    -   **Is recurring issue?** N
    -   **Should Test frontend/backend/both after fix?** Both.

**In progress Task List**:
-   **Task 1: Complete and Test the Hybrid Guidance System (P0)**
    -   **Where to resume:**
        1.  Verify the  fix (as described in the issue above).
        2.  Populate  with the step-by-step guides for all specified workflows (Attendance, Onboarding, Permissions, Approvals, Sales Flow, etc.).
        3.  Thoroughly test the end-to-end functionality using the testing agent.
    -   **What will be achieved with this?** A powerful, contextual help system will be available across the entire application, improving user onboarding and reducing support load.
    -   **Status:** IN PROGRESS
    -   **Should Test frontend/backend/both after fix?** Both.
    -   **Blocked on something:** Blocked on Issue 1: Verify Backend Fix for Guidance System.

**Upcoming and Future Tasks**
-   **(P1) Implement Sales Incentive Module:** Link incentives to the existing  records.
-   **(P2) Refactor :** Continue breaking down the monolithic  into domain-specific routers and services.
-   **(P2) Implement Full Pages for Placeholders:** The  and  pages are currently empty placeholders.
-   **(P2) Expand Finance and Project P&L Modules.**

**Completed work in this session**
-   **Centralized Approval System:** Refactored all approval workflows (Expenses, Kickoff, Go-Live, Bank Change, SOW) to use the centralized , ensuring consistent real-time email and WebSocket notifications.
-   **Approval Center Enhancements:** Implemented real-time refresh via WebSockets, bulk approval actions, and a responsive mobile-optimized UI for the  page.
-   **Day 0 Onboarding Tour:**
    -   Successfully implemented a custom guided tour after abandoning  due to compatibility issues.
    -   The tour is role-specific, starts automatically for new users, and includes a Replay Tour button on the user profile page.
    -   Added backend endpoints () to track user's tour completion status.

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: Data Integrity in Leave Requests**
    -   **Debug checklist:** A single leave request from a previous session has a malformed date string (25th Feb to 27th feb). Run a one-time script to fix or delete this record: .
    -   **Why to solve this issue and what will be achieved with this?** Cleans up bad data left over from a rolled-back feature, preventing potential errors in reporting or data processing.
    -   **Should Test frontend/backend/both after fix:** Backend (DB verification).
    -   **Is recurring issue?** N

**Known issue recurrence from previous fork**
-   **Issue recurrence in previous fork:** The monolithic  file.
-   **Recurrence count:** 18+
-   **Status:** IN PROGRESS (Mitigation is ongoing by moving logic into separate routers and services).

**Code Architecture**


**Key Technical Concepts**
-   **Hybrid Guidance System:** A feature combining static, predefined task checklists (from a JSON file) with an on-demand, AI-powered help modal that can trigger navigation.
-   **Custom Onboarding Component:** A lightweight, custom-built tour component using CSS and React state, created as a replacement for the incompatible  library.
-   **Centralized Service Pattern:** Logic for approvals, RBAC, and WebSockets has been abstracted into dedicated service modules, reducing the complexity of .
-   **Bulk Actions:** The Approval Center now supports selecting multiple items and performing a single action (e.g., approve all) via a dedicated backend endpoint.
-   **Real-time UI Updates:** Leveraging WebSockets to push data to the client (Approval Center, Notifications) without requiring polling or manual refreshes.

**key DB schema**
-   **:** Added . Will likely need  for the new guidance system.

**All files of reference**
-   : **New router** for the AI help system. (Last worked on)
-   : **New context** to manage the state of the guidance system.
-   : Significantly refactored to add real-time updates, bulk actions, and mobile views.
-   : **New component** for the custom Day 0 tour.
-   : Central service used by all workflows for notifications.
-   , : Refactored to use .
-   : Modified to integrate new routers and update various approval endpoints.

**Areas that need refactoring**:
-   ****: Remains the primary candidate for further refactoring.
-   ****: This file is now over 1600 lines long. It should be broken down into smaller, more manageable components (e.g., , , ).

**key api endpoints**
-   : **New endpoint** to get AI-powered help and navigation suggestions.
-   , : **New endpoints** for managing guidance state.
-   , : **New endpoints** to manage the user's onboarding tour status.
-   : **New endpoint** for performing bulk approvals.

**Critical Info for New Agent**
-   Your immediate priority is to complete the Hybrid Guidance System. Start by verifying the backend fix for the  error.
-   Once the backend is stable, the floating help button should appear on the UI. Your next task is to populate  with the required step-by-step guides.
-   After populating the checklists, conduct a full end-to-end test of the guidance system, ensuring the AI help and auto-navigation features work as specified by the user.

**documents and test reports created in this job**
-   
-   
-   
-   
-    (updated with completed tasks and new backlog items)

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Asks to implement real-time refresh, bulk actions, and mobile optimization for the Approval Center. (COMPLETED)
2.  **User:** Confirms the plan to implement all three Approval Center enhancements. (COMPLETED)
3.  **User:** Asks to implement a Day 0 guided onboarding tour. (COMPLETED)
4.  **User:** Provides specifications for the onboarding tour (trigger, content, storage). (COMPLETED)
5.  **User:** Compares the agent's tooltips suggestion with their vision for a more advanced AI-powered guidance system. (IN PROGRESS)
6.  **User:** Asks about compromises and credit usage for the AI guidance system. (IN PROGRESS)
7.  **User:** Confirms they want to proceed with the Hybrid option for the guidance system. (IN PROGRESS)
8.  **User:** Specifies that the Help Me button should be a floating button and provides a list of key workflows to create guides for. (IN PROGRESS)
9.  **User:** Specifies that the AI help response should auto-navigate the user. (IN PROGRESS)

**Project Health Check:**
-   **Healthy:** The application is stable and all previously requested features are complete. The current work is on a new, user-requested feature.

**3rd Party Integrations**
-   usage: openai [-h] [-v] [-b API_BASE] [-k API_KEY] [-p PROXY [PROXY ...]]
              [-o ORGANIZATION] [-t {openai,azure}]
              [--api-version API_VERSION] [--azure-endpoint AZURE_ENDPOINT]
              [--azure-ad-token AZURE_AD_TOKEN] [-V]
              {api,tools,migrate,grit} ...

positional arguments:
  {api,tools,migrate,grit}
    api                 Direct API calls
    tools               Client side tools for convenience

options:
  -h, --help            show this help message and exit
  -v, --verbose         Set verbosity.
  -b API_BASE, --api-base API_BASE
                        What API base url to use.
  -k API_KEY, --api-key API_KEY
                        What API key to use.
  -p PROXY [PROXY ...], --proxy PROXY [PROXY ...]
                        What proxy to use.
  -o ORGANIZATION, --organization ORGANIZATION
                        Which organization to run as (will use your default
                        organization if not specified)
  -t {openai,azure}, --api-type {openai,azure}
                        The backend API to call, must be `openai` or `azure`
  --api-version API_VERSION
                        The Azure API version, e.g.
                        'https://learn.microsoft.com/en-us/azure/ai-
                        services/openai/reference#rest-api-versioning'
  --azure-endpoint AZURE_ENDPOINT
                        The Azure endpoint, e.g.
                        'https://endpoint.openai.azure.com'
  --azure-ad-token AZURE_AD_TOKEN
                        A token from Azure Active Directory,
                        https://www.microsoft.com/en-
                        us/security/business/identity-access/microsoft-entra-
                        id
  -V, --version         show program's version number and exit: Used for the AI Assistant and the new AI Guidance System (via Emergent LLM Key).
-   : For creating secure JWTs for email action links.
-   usage: websockets [--version | <uri>]: For real-time notifications, chat, and Approval Center updates.
-   : Was installed but **removed** due to React compatibility issues.

**Testing status**
-   **Testing agent used after significant changes:** YES. Used successfully to test the Approval Center enhancements and the Onboarding Tour.
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** None.
-   **Known regressions:** None.

**Credentials to test flow:**
-   **Admin:**  / 
-   **HR Manager:**  / 
-   **Employee (Manager):**  / 
-   **Employee (Reportee):**  / 

**What agent forgot to execute**
-   The one-time data cleanup task for the malformed leave request record in the database is still pending from a previous session.</analysis>
